# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   @file           :   .taskfiles/terraform.yml
#   @description    :   terraform tasks
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
version: "3"

tasks:

  # task terraform:format:all
  format:all:
    desc: format all terraform configuration files to a canonical format
    cmds:
      - task: cloudflare:format
      - task: unifi:format
    silent: true

  # task terraform:init:all
  init:all:
    desc: initialize all terraform dependencies
    cmds:
      - task: cloudflare:init
      - task: unifi:init
    silent: true

  # task terraform:cloudflare:format
  cloudflare:format:
    desc: format cloudflare terraform configuration files to a canonical format
    cmds:
      - terraform fmt -recursive
    dir: ./cloudflare
    silent: true

  # task terraform:cloudflare:init
  cloudflare:init:
    desc: initialize cloudflare terraform dependencies
    cmds:
      - terraform init
    dir: ./cloudflare
    silent: true

  # task terraform:cloudflare:plan
  cloudflare:plan:
    desc: generate cloudflare execution plan
    cmds:
      - terraform plan
    dir: ./cloudflare
    silent: true

  # task terraform:cloudflare:apply
  cloudflare:apply:
    desc: execute generated cloudflare plan
    cmds:
      - terraform apply
    dir: ./cloudflare
    silent: true

  # task terraform:unifi:format
  unifi:format:
    desc: format unifi terraform configuration files to a canonical format
    cmds:
      - terraform fmt -recursive
    dir: ./unifi
    silent: true

  # task terraform:unifi:init
  unifi:init:
    desc: initialize unifi terraform dependencies
    cmds:
      - terraform init
    dir: ./unifi
    silent: true

  # task terraform:unifi:plan
  unifi:plan:
    desc: generate unifi execution plan
    cmds:
      - terraform plan
    dir: ./unifi
    silent: true

  # task terraform:unifi:apply
  unifi:apply:
    desc: execute generated unifi plan
    cmds:
      - terraform apply
    dir: ./unifi
    silent: true
