# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   @file           :   .taskfiles/terraform.yml
#   @description    :   terraform tasks
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
version: "3"

tasks:
  # task terraform:format
  format:
    desc: format terraform configuration files to a canonical format
    cmds:
      - terraform fmt -recursive
    silent: true

  # task terraform:init:all
  init:all:
    desc: initialize all terraform dependencies
    cmds:
      - task: init:cloudflare

  # task terraform:init:cloudflare
  init:cloudflare:
    desc: initialize cloudflare terraform dependencies
    cmds:
      - terraform init
    dir: ./cloudflare
    silent: true

  # task terraform:plan:cloudflare
  plan:cloudflare:
    desc: generate cloudflare execution plan
    cmds:
      - terraform plan
    dir: ./cloudflare
    silent: true

  # task terraform:apply:cloudflare
  apply:cloudflare:
    desc: execute generated cloudflare plan
    cmds:
      - terraform apply
    dir: ./cloudflare
    silent: true

  # task terraform:init:unifi
  init:unifi:
    desc: initialize unifi terraform dependencies
    cmds:
      - terraform init
    dir: ./unifi
    silent: true

  # task terraform:plan:unifi
  plan:unifi:
    desc: generate unifi execution plan
    cmds:
      - terraform plan
    dir: ./unifi
    silent: true

  # task terraform:apply:unifi
  apply:unifi:
    desc: execute generated unifi plan
    cmds:
      - terraform apply
    dir: ./unifi
    silent: true
