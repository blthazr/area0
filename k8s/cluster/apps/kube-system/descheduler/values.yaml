---
nameOverride: &app descheduler
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values: [*app]
          topologyKey: kubernetes.io/hostname
        weight: 100
deschedulerPolicy:
  strategies:
    LowNodeUtilization:
      enabled: false
    RemoveDuplicates:
      enabled: true
    RemoveFailedPods:
      enabled: true
      params:
        failedPods:
          excludeOwnerKinds:
            - Job
          includingInitContainers: true
          minPodLifetimeSeconds: 3600
    RemovePodsHavingTooManyRestarts:
      enabled: true
      params:
        podsHavingTooManyRestarts:
          includingInitContainers: true
          podRestartThreshold: 100
    RemovePodsViolatingInterPodAntiAffinity:
      enabled: true
      params:
        nodeFit: true
    RemovePodsViolatingNodeAffinity:
      enabled: true
      params:
        nodeAffinityType:
          - requiredDuringSchedulingIgnoredDuringExecution
    RemovePodsViolatingNodeTaints:
      enabled: true
    RemovePodsViolatingTopologySpreadConstraint:
      enabled: true
      params:
        includeSoftConstraints: true
kind: Deployment
leaderElection:
  enabled: true
  leaseDuration: 15s
  renewDeadline: 10s
  resourceLock: leases
  resourceName: descheduler
  resourceNamescape: default
  retryPeriod: 2s
podAnnotations:
  configmap.reloader.stakater.com/reload: *app
replicas: 3
service:
  enabled: true
serviceMonitor:
  enabled: true
