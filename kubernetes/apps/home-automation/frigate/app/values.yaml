---
nameOverride: &app frigate
env:
  LIBVA_DRIVER_NAME: i965
  FRIGATE_MQTT_HOST: "${MQTT_ADDRESS}"
  FRIGATE_MQTT_USER: "${SECRET_MQTT_USERNAME}"
  FRIGATE_MQTT_PASSWORD: "${SECRET_MQTT_PASSWORD}"
  FRIGATE_UNIFI_PROTECT_ADDRESS: "${UNIFI_PROTECT_ADDRESS}"
image:
  repository: ghcr.io/blakeblackshear/frigate
  tag: 0.12.0-rc1
ingress:
  main:
    annotations:
      hajimari.io/group: Home-Automation
      hajimari.io/icon: mdi:camera-enhance
    enabled: true
    hosts:
      - host: &host "{{ .Release.Name }}.${SECRET_DOMAIN}"
        paths:
          - path: /
            pathType: Prefix
    ingressClassName: nginx
    tls:
      - hosts:
          - *host
nodeSelector:
  google.feature.node.kubernetes.io/coral: "true"
  intel.feature.node.kubernetes.io/gpu: "true"
  node-role.kubernetes.io/worker: "true"
persistence:
  cache:
    enabled: true
    medium: Memory
    mountPath: /dev/shm
    sizeLimit: 4Gi
    type: emptyDir
  config-file:
    enabled: true
    mountPath: /config/config.yml
    name: frigate-config
    readOnly: true
    subPath: frigate-config.yaml
    type: configMap
  data:
    enabled: true
    existingClaim: frigate-data-v1
  media:
    enabled: true
    mountPath: /media
    path: "${NAS_NFS_PATH}/apps/frigate"
    server: "${NAS_ADDRESS}"
    type: nfs
  usb:
    enabled: true
    hostPath: /dev/bus/usb
    hostPathType: Directory
    mountPath: /dev/bus/usb
    type: hostPath
podAnnotations:
  configmap.reloader.stakater.com/reload: frigate-config
probes:
  liveness: &probes
    enabled: true
    custom: true
    spec:
      httpGet:
        path: /api/version
        port: 5000
      initialDelaySeconds: 0
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
  readiness: *probes
  startup:
    enabled: false
service:
  main:
    externalTrafficPolicy: Local
    loadBalancerIP: "${SVC_FRIGATE_ADDRESS}"
    ports:
      http:
        port: 5000
      rtsp:
        enabled: true
        port: 8554
    type: LoadBalancer
securityContext:
  privileged: true
