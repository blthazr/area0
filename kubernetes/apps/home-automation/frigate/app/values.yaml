---
nameOverride: &app frigate
env:
  LIBVA_DRIVER_NAME: i965
  TZ: "${CLUSTER_TIME_ZONE}"
envFrom:
  - secretRef:
      name: frigate-secrets
image:
  repository: ghcr.io/blakeblackshear/frigate
  tag: 0.12.0-beta2
ingress:
  main:
    enabled: true
    hosts:
      - host: &host "{{ .Release.Name }}.${SECRET_DOMAIN}"
        paths:
          - path: /
            pathType: Prefix
    ingressClassName: nginx
    tls:
      - hosts:
          - *host
nodeSelector:
  intel.feature.node.kubernetes.io/gpu: "true"
  google.feature.node.kubernetes.io/coral: "true"
  node-role.kubernetes.io/worker: "true"
persistence:
  cache:
    enabled: true
    medium: Memory
    mountPath: /dev/shm
    sizeLimit: 4Gi
    type: emptyDir
  config:
    enabled: true
    mountPath: /config/config.yml
    name: frigate-config
    readOnly: true
    subPath: frigate-config.yaml
    type: configMap
  data:
    enabled: true
    existingClaim: frigate-data-v1
  media:
    enabled: true
    mountPath: /media
    path: "${NAS_NFS_PATH}/apps/frigate"
    server: "${NAS_ADDRESS}"
    type: nfs
  usb:
    enabled: true
    hostPath: /dev/bus/usb
    hostPathType: Directory
    mountPath: /dev/bus/usb
    type: hostPath
podAnnotations:
  configmap.reloader.stakater.com/reload: frigate-config
  secret.reloader.stakater.com/reload: frigate-secrets
probes:
  liveness: &probe
    custom: true
    enabled: true
    spec:
      failureThreshold: 3
      httpGet:
        path: /api/version
        port: &port 5000
      initialDelaySeconds: 0
      periodSeconds: 10
      timeoutSeconds: 1
  readiness: *probe
  startup:
    enabled: false
securityContext:
  privileged: true
service:
  main:
    externalTrafficPolicy: Local
    loadBalancerIP: "${SVC_FRIGATE_ADDRESS}"
    ports:
      http:
        port: *port
      rtsp:
        enabled: true
        port: 8554
    type: LoadBalancer
