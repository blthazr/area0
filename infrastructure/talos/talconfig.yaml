# yaml-language-server: $schema=https://raw.githubusercontent.com/budimanjojo/talhelper/master/pkg/config/schemas/talconfig.json
---
# renovate: datasource=docker depName=ghcr.io/siderolabs/installer
talosVersion: v1.9.2
# renovate: datasource=docker depName=ghcr.io/siderolabs/kubelet
kubernetesVersion: v1.32.1

clusterName: ${clusterName}
endpoint: https://${clusterEndpointIP}:6443

clusterPodNets:
  - 10.42.0.0/16
clusterSvcNets:
  - 10.43.0.0/16

additionalApiServerCertSans: &sans
  - &talosControlPlaneVIP ${clusterEndpointIP}
  - 127.0.0.1 # KubePrism
additionalMachineCertSans: *sans

# Disable built-in Flannel to use Cilium
cniConfig:
  name: none

nodes:
  - hostname: k8s-1
    controlPlane: true
    installDiskSelector:
      wwid: naa.5002538900000000
    ipAddress: 172.16.21.11
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: 78:7b:8a:cc:06:17
        dhcp: true
        mtu: 1500
        vip:
          ip: *talosControlPlaneVIP
    talosImageURL: factory.talos.dev/installer/376567988ad370138ad8b2698212367b8edcb69b5fd68c80be1f2ec7d603b4ba
  - hostname: k8s-2
    controlPlane: true
    installDiskSelector:
      wwid: naa.5002538900000000
    ipAddress: 172.16.21.12
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: 78:7b:8a:cc:07:ca
        dhcp: true
        mtu: 1500
        vip:
          ip: *talosControlPlaneVIP
    talosImageURL: factory.talos.dev/installer/376567988ad370138ad8b2698212367b8edcb69b5fd68c80be1f2ec7d603b4ba
  - hostname: k8s-3
    controlPlane: true
    installDiskSelector:
      wwid: naa.5002538900000000
    ipAddress: 172.16.21.13
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: a8:60:b6:24:dd:6e
        dhcp: true
        mtu: 1500
        vip:
          ip: *talosControlPlaneVIP
    talosImageURL: factory.talos.dev/installer/376567988ad370138ad8b2698212367b8edcb69b5fd68c80be1f2ec7d603b4ba
  - hostname: k8s-4
    controlPlane: false
    installDiskSelector:
      wwid: naa.5000cca82ac496b7
    ipAddress: 172.16.21.14
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: 38:c9:86:0d:dd:db
        dhcp: true
        mtu: 1500
    talosImageURL: factory.talos.dev/installer/376567988ad370138ad8b2698212367b8edcb69b5fd68c80be1f2ec7d603b4ba

# Global patches
patches:
  - "@./patches/global/containerd.yaml"
  - "@./patches/global/disable-search-domain.yaml"
  - "@./patches/global/host-entries.yaml"
  - "@./patches/global/hostdns.yaml"
  - "@./patches/global/installer.yaml"
  - "@./patches/global/kubelet.yaml"
  - "@./patches/global/nameserver.yaml"
  - "@./patches/global/ntp.yaml"
  - "@./patches/global/openebs.yaml"
  - "@./patches/global/sysctl.yaml"

# Controller patches
controlPlane:
  patches:
    - "@./patches/controller/admission-controller-patch.yaml"
    - "@./patches/controller/api-access-shard.yaml"
    - "@./patches/controller/cluster.yaml"
    - "@./patches/controller/etcd.yaml"
