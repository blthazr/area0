# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   @file           :   tasks/Debian/main.yaml
#   @description    :   Debian tasks executed by ansible-role-os-identification
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
- name: Unifi | get firmware file stats
  ansible.builtin.stat:
    path: "{{ unifi_version_file_path }}"
  register: unifi_firmware_file

- name: Unifi
  when:
    - unifi_firmware_file.stat.exists
  block:
    - name: Unifi | load firmware file
      ansible.builtin.shell: "cat {{ unifi_version_file_path }}"
      register: unifi_firmware

    - name: Unifi | process firmware file
      ansible.builtin.set_fact:
        unifi_firmware: "{{ unifi_firmware.stdout | from_yaml }}"

    - name: Unifi | setting facts
      ansible.builtin.set_fact:
        ansible_distribution: Unifi
        ansible_distribution_file_parsed: true
        ansible_distribution_file_path: "{{ unifi_version_file_path }}"
        ansible_distribution_file_variety: Unifi
        ansible_distribution_major_version: "{{ unifi_firmware.latest.version_major }}"
        ansible_distribution_minor_version: "{{ unifi_firmware.latest.version_minor }}"
        ansible_distribution_release: ""
        ansible_distribution_version: "{{ unifi_firmware.latest.version_major }}"
        ansible_os_family: Unifi
