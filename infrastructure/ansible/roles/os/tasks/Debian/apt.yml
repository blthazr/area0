# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   @file           :   tasks/Debian/apt.yml
#   @description    :   Debian apt tasks
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
- name: "{{ ansible_os_family }} | apt | disable cdrom sources"
  ansible.builtin.replace:
    path: "/etc/apt/sources.list"
    regexp: '^(deb\scdrom.*$)'
    replace: '#\1'

- name: "{{ ansible_os_family }} | apt | add apt repositories"
  ansible.builtin.apt_repository:
    repo: "{{ os_package_repository.debian.repo_add | default([]) }}"
    update_cache: true
  register: debian_repo_add
  retries: 5
  until: debian_repo_add is success

- name: "{{ ansible_os_family }} | apt | disable APT recommends"
  ansible.builtin.blockinfile:
    path: /etc/apt/apt.conf.d/02norecommends
    mode: 0644
    create: true
    block: |
      APT::Install-Recommends "false";
      APT::Install-Suggests "false";
      APT::Get::Install-Recommends "false";
      APT::Get::Install-Suggests "false";
