# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   @file           :   tasks/Debian/group.yaml
#   @description    :   Debian group tasks
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
- name: "{{ ansible_os_family }} | main | create user group(s)"
  ansible.builtin.group:
    name: "{{ item.name }}"
    gid: "{{ item.gid | default(omit) }}"
    state: present
    system: "{{ item.system | default('no') }}"
  loop: "{{ user_groups }}"

- name: "{{ ansible_os_family }} | main | create prerequesite primary group(s)"
  ansible.builtin.group:
    name: "{{ item.group }}"
    state: present
  when: '"group" in item'
  loop: "{{ users }}"

- name: "{{ ansible_os_family }} | main | create a group per-user"
  ansible.builtin.group:
    name: "{{ item.username }}"
    state: present
  when:
    - "users is defined"
    - 'group_per_user and "group" not in item'
  loop: "{{ users }}"
